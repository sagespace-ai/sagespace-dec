# Security Vulnerability Detection Guide

## Current State

### What's Currently Implemented

✅ **npm audit in CI** - Automated security scanning on every push/PR  
✅ **GitHub Dependabot** - Automatic dependency vulnerability alerts and PRs  
✅ **Security scripts** - Easy commands to run audits (`npm run security:audit`)  
✅ **TypeScript type checking** - Catches type-related issues  
✅ **ESLint** - Catches code quality issues  
✅ **Sentry error tracking** - Monitors runtime errors  
⚠️ **No code-level security scanning** - ESLint security plugin recommended  
⚠️ **No runtime security scanning** - OWASP ZAP recommended for production  

## How Vulnerabilities Are Currently Identified

### 1. Manual npm Audit

**Command:**
\`\`\`bash
npm audit
\`\`\`

**What it checks:**
- Known vulnerabilities in `node_modules`
- Outdated packages with security issues
- Dependency vulnerabilities

**Output:**
\`\`\`
# npm audit report

lodash  <4.17.21
Severity: high
Regular Expression Denial of Service (ReDoS) - https://npmjs.com/advisories/1523
fix available via `npm audit fix`
\`\`\`

**Limitations:**
- Must be run manually
- Only checks npm registry vulnerabilities
- Doesn't check code-level issues
- Doesn't check configuration issues

### 2. TypeScript Compiler

**Command:**
\`\`\`bash
npm run type-check
# or
tsc --noEmit
\`\`\`

**What it checks:**
- Type safety issues
- Potential runtime errors
- Missing type definitions

**Limitations:**
- Only catches type-related issues
- Doesn't check for security vulnerabilities
- Doesn't check dependencies

### 3. ESLint

**Command:**
\`\`\`bash
npm run lint
\`\`\`

**What it checks:**
- Code quality issues
- Potential bugs
- Best practices

**Limitations:**
- Not security-focused by default
- Doesn't check dependencies
- Doesn't check for known vulnerabilities

### 4. Build Process

**Command:**
\`\`\`bash
npm run build
\`\`\`

**What it checks:**
- TypeScript compilation errors
- Import resolution issues
- Build-time errors

**Limitations:**
- Only catches build errors
- Doesn't check for vulnerabilities

## Recommended Security Scanning Tools

### Option 1: npm audit (Built-in, Free)

**Setup:**
\`\`\`bash
# Check for vulnerabilities
npm audit

# Fix automatically fixable issues
npm audit fix

# Force fix (may include breaking changes)
npm audit fix --force
\`\`\`

**Add to CI:**
\`\`\`yaml
# .github/workflows/security.yml
- name: Run npm audit
  run: npm audit --audit-level=moderate
\`\`\`

**Pros:**
- ✅ Free
- ✅ Built into npm
- ✅ No additional setup
- ✅ Checks all dependencies

**Cons:**
- ❌ Only checks npm registry
- ❌ Doesn't check code-level issues
- ❌ Limited to known CVEs

### Option 2: GitHub Dependabot (Free, Recommended)

**Setup:**
1. Go to GitHub repository
2. Settings → Security → Code security and analysis
3. Enable "Dependabot alerts"
4. Enable "Dependabot security updates"

**What it does:**
- Automatically scans dependencies
- Creates PRs for security updates
- Alerts on new vulnerabilities
- Works with npm, Docker, GitHub Actions

**Configuration:**
Create `.github/dependabot.yml`:
\`\`\`yaml
version: 2
updates:
  - package-ecosystem: "npm"
    directory: "/"
    schedule:
      interval: "weekly"
    open-pull-requests-limit: 10
\`\`\`

**Pros:**
- ✅ Free for public repos
- ✅ Automatic scanning
- ✅ Creates PRs automatically
- ✅ Monitors continuously

**Cons:**
- ⚠️ Requires GitHub repository
- ⚠️ Limited to dependency scanning

### Option 3: Snyk (Free Tier Available)

**Setup:**
\`\`\`bash
# Install Snyk CLI
npm install -g snyk

# Authenticate
snyk auth

# Test for vulnerabilities
snyk test

# Monitor project
snyk monitor
\`\`\`

**Add to CI:**
\`\`\`yaml
- name: Run Snyk security scan
  uses: snyk/actions/node@master
  env:
    SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
\`\`\`

**Pros:**
- ✅ Free tier available
- ✅ Comprehensive scanning
- ✅ Code + dependency scanning
- ✅ CI/CD integration

**Cons:**
- ⚠️ Requires account setup
- ⚠️ Free tier has limits

### Option 4: OWASP ZAP (Free, Open Source)

**Setup:**
\`\`\`bash
# Install OWASP ZAP
# Or use Docker
docker run -t owasp/zap2docker-stable zap-baseline.py -t http://localhost:5173
\`\`\`

**What it checks:**
- XSS vulnerabilities
- SQL injection
- CSRF issues
- Security headers
- Authentication issues

**Pros:**
- ✅ Free and open source
- ✅ Comprehensive security testing
- ✅ Scans running application

**Cons:**
- ⚠️ Requires running application
- ⚠️ More complex setup
- ⚠️ Manual or CI integration needed

### Option 5: SonarQube (Free Community Edition)

**Setup:**
- Self-hosted or cloud
- Scans code for security issues
- Detects vulnerabilities, bugs, code smells

**Pros:**
- ✅ Comprehensive code analysis
- ✅ Security-focused rules
- ✅ Free community edition

**Cons:**
- ⚠️ Requires server setup
- ⚠️ More complex configuration

## ✅ What's Been Set Up

### Automated Security Scanning (Just Added)

1. **✅ npm audit in CI Pipeline:**
   - Added to `.github/workflows/ci.yml`
   - Runs on every push and PR
   - Scans both frontend and API dependencies
   - Checks for moderate+ severity vulnerabilities

2. **✅ GitHub Dependabot Configuration:**
   - Created `.github/dependabot.yml`
   - Weekly dependency scanning
   - Automatic security update PRs
   - Monitors both frontend and API packages

3. **✅ Security Scripts:**
   - `npm run security:audit` - Check frontend vulnerabilities
   - `npm run security:audit:api` - Check API vulnerabilities
   - `npm run security:audit:all` - Check both
   - `npm run security:fix` - Auto-fix frontend issues
   - `npm run security:fix:api` - Auto-fix API issues

### Enable Dependabot (One-Time Setup)

1. Go to GitHub → Your Repository
2. Settings → Security → Code security and analysis
3. Enable **"Dependabot alerts"**
4. Enable **"Dependabot security updates"**

This will automatically:
- Scan dependencies for vulnerabilities
- Create PRs for security updates
- Alert you to new vulnerabilities

### Phase 2: Enhanced Scanning (Short-term)

1. **Add Snyk:**
   - Sign up for free account
   - Add to CI pipeline
   - Monitor dependencies

2. **Add ESLint security plugin:**
   \`\`\`bash
   npm install --save-dev eslint-plugin-security
   \`\`\`
   
   Update `.eslintrc`:
   \`\`\`json
   {
     "plugins": ["security"],
     "extends": ["plugin:security/recommended"]
   }
   \`\`\`

### Phase 3: Comprehensive Security (Long-term)

1. **OWASP ZAP scanning:**
   - Add to CI for staging/production
   - Regular security scans

2. **Code-level security scanning:**
   - SonarQube or similar
   - Static analysis

3. **Penetration testing:**
   - Regular security audits
   - Professional security review

## Current Vulnerabilities Check

### Check Now

\`\`\`bash
# Frontend
npm audit

# Backend API
cd api && npm audit
\`\`\`

### Fix Vulnerabilities

\`\`\`bash
# Auto-fix (safe)
npm audit fix

# Force fix (may break things)
npm audit fix --force

# Update specific package
npm update package-name
\`\`\`

## Security Scanning Checklist

### Dependency Scanning
- [ ] npm audit configured
- [ ] GitHub Dependabot enabled
- [ ] Snyk or similar tool configured
- [ ] Regular dependency updates

### Code Scanning
- [ ] ESLint security plugin
- [ ] TypeScript strict mode
- [ ] Static analysis tool (SonarQube, etc.)

### Runtime Scanning
- [ ] OWASP ZAP for running app
- [ ] Security headers check
- [ ] Penetration testing

### CI/CD Integration
- [ ] Security scan in CI pipeline
- [ ] Block merges on critical vulnerabilities
- [ ] Automated security updates

## Common Vulnerability Types Detected

### 1. Dependency Vulnerabilities
- **Source**: npm audit, Dependabot, Snyk
- **Examples**: 
  - Outdated packages with known CVEs
  - Vulnerable transitive dependencies
  - Packages with security advisories

### 2. Code-Level Vulnerabilities
- **Source**: ESLint security, SonarQube, manual review
- **Examples**:
  - SQL injection risks
  - XSS vulnerabilities
  - Hardcoded secrets
  - Insecure random number generation

### 3. Configuration Vulnerabilities
- **Source**: Manual review, security scanners
- **Examples**:
  - Missing security headers
  - Weak CORS configuration
  - Insecure session settings
  - Exposed environment variables

### 4. Runtime Vulnerabilities
- **Source**: OWASP ZAP, penetration testing
- **Examples**:
  - Authentication bypass
  - Authorization flaws
  - CSRF vulnerabilities
  - Session fixation

## Automated Security Scanning Setup

### GitHub Actions Workflow

Create `.github/workflows/security.yml`:

\`\`\`yaml
name: Security Scan

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  schedule:
    - cron: '0 0 * * 0' # Weekly

jobs:
  npm-audit:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
      - name: Install dependencies
        run: npm ci
      - name: Run npm audit
        run: npm audit --audit-level=moderate
      - name: Run npm audit (API)
        run: |
          cd api
          npm ci
          npm audit --audit-level=moderate

  snyk:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: snyk/actions/node@master
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
        with:
          args: --severity-threshold=high
\`\`\`

## Security Monitoring

### Continuous Monitoring

1. **Dependabot Alerts:**
   - Automatic alerts on new vulnerabilities
   - PRs created for security updates

2. **Snyk Monitoring:**
   - Continuous dependency scanning
   - Email alerts on new issues

3. **Sentry:**
   - Runtime error tracking
   - Security-related errors flagged

## Reporting Vulnerabilities

### If You Find a Vulnerability

1. **Don't create a public issue** (security risk)
2. **Contact maintainers privately:**
   - Email security team
   - Use GitHub Security Advisories
   - Responsible disclosure

3. **Document the issue:**
   - Severity level
   - Impact assessment
   - Steps to reproduce
   - Suggested fix

## Best Practices

### Regular Scanning
- ✅ Run `npm audit` weekly
- ✅ Review Dependabot alerts daily
- ✅ Update dependencies monthly
- ✅ Security audit quarterly

### Dependency Management
- ✅ Pin dependency versions
- ✅ Review dependency updates
- ✅ Remove unused dependencies
- ✅ Use `npm ci` in production

### Code Security
- ✅ Follow security best practices
- ✅ Regular code reviews
- ✅ Security-focused linting
- ✅ Input validation everywhere

---

## Quick Start: Enable Security Scanning

### Step 1: Enable GitHub Dependabot (5 minutes)

1. Go to GitHub → Repository → Settings
2. Security → Code security and analysis
3. Enable "Dependabot alerts"
4. Enable "Dependabot security updates"

### Step 2: Add npm audit to CI (10 minutes)

Create `.github/workflows/security.yml` (see template above)

### Step 3: Run Initial Audit (2 minutes)

\`\`\`bash
npm audit
cd api && npm audit
\`\`\`

### Step 4: Fix Critical Issues

\`\`\`bash
npm audit fix
\`\`\`

---

**Last Updated**: Current  
**Status**: Manual scanning available, automated scanning recommended
