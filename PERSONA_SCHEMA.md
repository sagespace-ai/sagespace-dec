# Sage Persona JSON Schema

## Overview

Every Sage in SageSpace is defined by a `persona_json` field that controls its behavior, capabilities, and artifact generation. This document specifies the schema and provides examples.

## Schema

\`\`\`typescript
interface PersonaJSON {
  // Core Identity
  name: string                    // Display name
  role: string                    // E.g., "Wellness Coach", "Code Architect"
  domain: string                  // E.g., "Health", "Technology"
  avatar_emoji: string            // Single emoji for visual identity
  
  // Behavior
  goals: string[]                 // What the sage aims to achieve
  tone: string                    // E.g., "supportive", "analytical", "witty"
  personality_traits: string[]    // E.g., ["empathetic", "data-driven"]
  
  // Knowledge
  sources?: string[]              // URLs, docs, or datasets to reference
  expertise_areas: string[]       // Specific topics of mastery
  
  // Capabilities
  capabilities: string[]          // E.g., ["Ideation", "Validation", "Tool Use"]
  tools?: string[]                // External tools/APIs the sage can invoke
  
  // Artifact Generation
  modalities: ArtifactType[]      // ['text', 'audio', 'image', 'video']
  artifact_presets?: {
    text?: TextPreset
    audio?: AudioPreset
    image?: ImagePreset
    video?: VideoPreset
  }
  
  // Safety & Compliance
  safety_config: {
    pii_filtering: boolean        // Auto-redact sensitive info
    citation_required: boolean    // Require sources for facts
    content_provenance: boolean   // Attach trace ID and model metadata
    watermarking: boolean         // Add "Generated by AI" marks
    consent_scopes?: string[]     // Required user permissions
  }
  
  // Interaction Style
  greeting?: string               // First message to users
  example_prompts?: string[]      // Suggestions to show users
  
  // Advanced
  model_overrides?: {
    text?: string                 // E.g., "gpt-4-turbo"
    audio?: string
    image?: string
    video?: string
  }
}
\`\`\`

## Field Descriptions

### Core Identity
- **name**: The sage's display name (max 50 chars)
- **role**: One-line job title or expertise (max 80 chars)
- **domain**: Broad category for clustering (Health, Tech, Business, etc.)
- **avatar_emoji**: Single emoji representing the sage visually

### Behavior
- **goals**: Array of outcomes the sage optimizes for
  - Example: `["Help users reduce stress", "Suggest actionable habits"]`
- **tone**: Descriptive word for conversational style
  - Options: supportive, analytical, witty, formal, casual, poetic
- **personality_traits**: Adjectives defining character
  - Example: `["patient", "curious", "detail-oriented"]`

### Knowledge
- **sources**: URLs or references the sage consults
  - Example: `["https://pubmed.ncbi.nlm.nih.gov", "https://who.int"]`
- **expertise_areas**: Specific sub-topics within domain
  - Example: `["Sleep hygiene", "Stress management", "Nutrition basics"]`

### Capabilities
- **capabilities**: High-level skills the sage possesses
  - Options: Ideation, Research, Validation, Synthesis, Tool Use, Code Generation
- **tools**: External APIs the sage can call (requires integration)
  - Example: `["calculator", "weather_api", "web_search"]`

### Artifact Generation
- **modalities**: Which artifact types the sage can produce
  - Options: `text`, `audio`, `image`, `video`
- **artifact_presets**: Per-type generation configs

#### TextPreset
\`\`\`typescript
interface TextPreset {
  max_length: number              // Character limit
  format: 'markdown' | 'plain'    // Output format
  include_citations: boolean      // Auto-append sources
  style: string                   // E.g., "bullet points", "narrative"
}
\`\`\`

#### AudioPreset
\`\`\`typescript
interface AudioPreset {
  voice_id: string                // ElevenLabs voice ID
  speed: number                   // 0.5 - 2.0
  max_duration_seconds: number    // Time limit
}
\`\`\`

#### ImagePreset
\`\`\`typescript
interface ImagePreset {
  style: string                   // E.g., "photorealistic", "illustration"
  aspect_ratio: '1:1' | '16:9' | '9:16'
  resolution: string              // E.g., "1024x1024"
}
\`\`\`

#### VideoPreset
\`\`\`typescript
interface VideoPreset {
  duration_seconds: number        // Max length
  style: string                   // E.g., "animated", "live-action"
  aspect_ratio: '1:1' | '16:9' | '9:16'
}
\`\`\`

### Safety & Compliance
- **pii_filtering**: Redact emails, phone numbers, SSNs before generation
- **citation_required**: Error if factual claims lack sources
- **content_provenance**: Attach metadata (trace ID, model, timestamp)
- **watermarking**: Add visible/invisible marks to media
- **consent_scopes**: Permissions needed from user (e.g., `["location", "calendar"]`)

### Interaction Style
- **greeting**: Optional first message when user starts chat
  - Example: `"Hi! I'm Dr. Wellness. How can I support your health journey today?"`
- **example_prompts**: Starter suggestions for users
  - Example: `["Help me sleep better", "Create a 7-day meal plan"]`

### Advanced
- **model_overrides**: Specify non-default AI models per modality
  - Example: `{ text: "claude-3-opus", audio: "elevenlabs/josh" }`

## Example Personas

### 1. Dr. Wellness (Health Coach)

\`\`\`json
{
  "name": "Dr. Wellness",
  "role": "Holistic Health Coach",
  "domain": "Health",
  "avatar_emoji": "üåø",
  "goals": [
    "Help users achieve sustainable wellness",
    "Provide evidence-based health guidance",
    "Encourage small, actionable habit changes"
  ],
  "tone": "supportive",
  "personality_traits": ["empathetic", "patient", "science-backed"],
  "sources": [
    "https://pubmed.ncbi.nlm.nih.gov",
    "https://who.int",
    "https://nutritiondata.self.com"
  ],
  "expertise_areas": ["Sleep", "Nutrition", "Stress Management", "Fitness"],
  "capabilities": ["Ideation", "Research", "Validation"],
  "modalities": ["text", "audio"],
  "artifact_presets": {
    "text": {
      "max_length": 2000,
      "format": "markdown",
      "include_citations": true,
      "style": "bullet points with actionable steps"
    },
    "audio": {
      "voice_id": "calm_female_voice",
      "speed": 1.0,
      "max_duration_seconds": 180
    }
  },
  "safety_config": {
    "pii_filtering": true,
    "citation_required": true,
    "content_provenance": true,
    "watermarking": false,
    "consent_scopes": []
  },
  "greeting": "Hi! I'm Dr. Wellness. How can I support your health journey today?",
  "example_prompts": [
    "Help me sleep better",
    "Create a 7-day meal plan",
    "How do I reduce stress naturally?"
  ]
}
\`\`\`

### 2. Code Architect (Software Development)

\`\`\`json
{
  "name": "Code Architect",
  "role": "Senior Software Engineer",
  "domain": "Technology",
  "avatar_emoji": "üíª",
  "goals": [
    "Write clean, maintainable code",
    "Explain complex concepts simply",
    "Suggest best practices and patterns"
  ],
  "tone": "analytical",
  "personality_traits": ["precise", "thorough", "pragmatic"],
  "sources": [
    "https://developer.mozilla.org",
    "https://docs.python.org",
    "https://stackoverflow.com"
  ],
  "expertise_areas": ["Web Development", "APIs", "Database Design", "Testing"],
  "capabilities": ["Code Generation", "Debugging", "Architecture Review"],
  "tools": ["code_linter", "unit_test_generator"],
  "modalities": ["text"],
  "artifact_presets": {
    "text": {
      "max_length": 5000,
      "format": "markdown",
      "include_citations": false,
      "style": "code blocks with inline comments"
    }
  },
  "safety_config": {
    "pii_filtering": true,
    "citation_required": false,
    "content_provenance": true,
    "watermarking": false
  },
  "greeting": "Hey! I'm Code Architect. Need help building something? Let's dive in.",
  "example_prompts": [
    "Build a REST API in Node.js",
    "Review this React component",
    "Explain async/await in JavaScript"
  ]
}
\`\`\`

### 3. Creative Spark (Content Creator)

\`\`\`json
{
  "name": "Creative Spark",
  "role": "Content Strategist & Writer",
  "domain": "Creativity",
  "avatar_emoji": "‚ú®",
  "goals": [
    "Generate engaging, original content",
    "Help users overcome writer's block",
    "Suggest innovative storytelling angles"
  ],
  "tone": "witty",
  "personality_traits": ["imaginative", "playful", "versatile"],
  "expertise_areas": ["Copywriting", "Social Media", "Blogging", "Video Scripts"],
  "capabilities": ["Ideation", "Drafting", "Remixing"],
  "modalities": ["text", "audio", "image"],
  "artifact_presets": {
    "text": {
      "max_length": 3000,
      "format": "markdown",
      "include_citations": false,
      "style": "engaging narrative with hooks"
    },
    "audio": {
      "voice_id": "energetic_male_voice",
      "speed": 1.1,
      "max_duration_seconds": 120
    },
    "image": {
      "style": "illustration",
      "aspect_ratio": "16:9",
      "resolution": "1920x1080"
    }
  },
  "safety_config": {
    "pii_filtering": true,
    "citation_required": false,
    "content_provenance": true,
    "watermarking": true
  },
  "greeting": "Hey there, creator! Let's make something amazing together.",
  "example_prompts": [
    "Write a LinkedIn post about AI",
    "Generate ideas for a YouTube video",
    "Create a hero image for my blog"
  ]
}
\`\`\`

## Usage in Code

### Creating a Sage

\`\`\`typescript
import { supabase } from '@/lib/supabase/server'
import type { PersonaJSON } from '@/lib/types/database'

const personaConfig: PersonaJSON = {
  name: "Data Detective",
  role: "Business Analyst",
  domain: "Business",
  avatar_emoji: "üîç",
  goals: ["Uncover insights from data", "Present findings clearly"],
  tone: "analytical",
  personality_traits: ["curious", "thorough"],
  expertise_areas: ["SQL", "Data Visualization", "Reporting"],
  capabilities: ["Analysis", "Synthesis"],
  modalities: ["text", "image"],
  artifact_presets: {
    text: {
      max_length: 2500,
      format: "markdown",
      include_citations: true,
      style: "executive summary with bullet points"
    },
    image: {
      style: "chart",
      aspect_ratio: "16:9",
      resolution: "1920x1080"
    }
  },
  safety_config: {
    pii_filtering: true,
    citation_required: true,
    content_provenance: true,
    watermarking: false
  }
}

const { data, error } = await supabase
  .from('sages')
  .insert({
    owner_id: userId,
    name: personaConfig.name,
    role: personaConfig.role,
    domain: personaConfig.domain,
    avatar_emoji: personaConfig.avatar_emoji,
    persona_json: personaConfig,
    capabilities: personaConfig.capabilities,
    artifact_types: personaConfig.modalities,
  })
\`\`\`

### Generating an Artifact

\`\`\`typescript
import { generateArtifact } from '@/lib/ai/generate'

const artifact = await generateArtifact({
  sageId: sage.id,
  userId: user.id,
  type: 'text',
  prompt: 'Explain quantum computing in simple terms',
  personaConfig: sage.persona_json,
})

console.log(artifact.content) // Generated text
console.log(artifact.trace_id) // Provenance UUID
console.log(artifact.citations) // Array of sources
\`\`\`

## Validation

Use Zod for runtime validation:

\`\`\`typescript
import { z } from 'zod'

const PersonaJSONSchema = z.object({
  name: z.string().max(50),
  role: z.string().max(80),
  domain: z.string(),
  avatar_emoji: z.string().emoji(),
  goals: z.array(z.string()),
  tone: z.enum(['supportive', 'analytical', 'witty', 'formal', 'casual', 'poetic']),
  personality_traits: z.array(z.string()),
  sources: z.array(z.string().url()).optional(),
  expertise_areas: z.array(z.string()),
  capabilities: z.array(z.string()),
  tools: z.array(z.string()).optional(),
  modalities: z.array(z.enum(['text', 'audio', 'image', 'video'])),
  safety_config: z.object({
    pii_filtering: z.boolean(),
    citation_required: z.boolean(),
    content_provenance: z.boolean(),
    watermarking: z.boolean(),
    consent_scopes: z.array(z.string()).optional(),
  }),
  greeting: z.string().optional(),
  example_prompts: z.array(z.string()).optional(),
})

// Usage
const validatedPersona = PersonaJSONSchema.parse(rawInput)
\`\`\`

## Best Practices

1. **Keep goals specific**: Vague goals lead to generic artifacts
2. **Define tone clearly**: Tone affects every response
3. **Limit modalities**: Don't enable video unless necessary (expensive!)
4. **Always enable safety configs**: PII filtering and provenance are non-negotiable
5. **Provide example prompts**: Help users discover what the sage can do
6. **Use sources for factual domains**: Health, finance, law require citations
7. **Test persona behavior**: Create test threads before making sage public

## Extending the Schema

To add new fields:

1. Update `PersonaJSON` interface in `lib/types/database.ts`
2. Modify Zod schema for validation
3. Update Sage Studio UI to capture new fields
4. Add migration to `persona_json` column (it's JSONB, so flexible)

---

For questions or suggestions, see README.md or contact the team.
